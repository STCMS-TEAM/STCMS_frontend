<div class="match-section p-2 bg-dark">
  <div class="container rounded bg-dark">
    <div class="d-flex flex-column gap-2">
      <!-- Tabs -->
      <div class="d-flex flex-wrap justify-content-center gap-2 p-2">
        @for (tab of tabs; track $index) {
        <div
          class="d-flex align-items-center px-3 py-2 rounded cursor-pointer text-white"
          [class.bg-danger]="activeTab === tab"
          [class.bg-secondary]="activeTab !== tab"
          [class.fw-bold]="activeTab === tab"
          (click)="setActive(tab)"
        >
          {{ tab }}
        </div>
        }
      </div>

      <!-- Matches -->
      <div class="d-flex flex-column gap-2">
        @for(match of matchesOfTournament(); track match._id || $index) {
        <div class="card bg-secondary text-white p-2">
          <div class="d-flex justify-content-between flex-wrap align-items-center">
            <div class="d-flex align-items-center text-center">
              {{match.startDate | date:'shortTime'}}
            </div>

            <div class="d-flex flex-column mx-2">
              <div>{{match.teams?.[0]?.name ?? '-'}}</div>
              <div>{{match.teams?.[1]?.name ?? '-'}}</div>
            </div>

            @if (editingMatchId === match._id) {
            <div class="match-edit-form">
              <div class="match-edit-row">
                <span class="match-edit-team-name">{{ match.teams?.[0]?.name ?? 'Team 1' }}</span>
                <input type="number" min="0" class="form-control form-control-sm score-input" [value]="getScore(match, getTeamId(match.teams?.[0]))" (input)="setEditScore(getTeamId(match.teams?.[0]), +$any($event.target).value)" placeholder="0" />
              </div>
              <div class="match-edit-row">
                <span class="match-edit-team-name">{{ match.teams?.[1]?.name ?? 'Team 2' }}</span>
                <input type="number" min="0" class="form-control form-control-sm score-input" [value]="getScore(match, getTeamId(match.teams?.[1]))" (input)="setEditScore(getTeamId(match.teams?.[1]), +$any($event.target).value)" placeholder="0" />
              </div>
              <div class="match-edit-actions">
                <button type="button" class="btn btn-sm btn-success" (click)="saveScores(match)" [disabled]="saving">Save</button>
                <button type="button" class="btn btn-sm btn-primary" (click)="markAsCompleted(match)" [disabled]="saving">Mark completed</button>
                <button type="button" class="btn btn-sm btn-outline-light" (click)="cancelEdit()" [disabled]="saving">Cancel</button>
              </div>
            </div>
            } @else {
            <div class="d-flex align-items-center gap-2">
              <div class="d-flex flex-column text-white text-center">
                <div>{{match.result?.score?.[getTeamId(match.teams?.[0])] ?? '-'}}</div>
                <div>{{match.result?.score?.[getTeamId(match.teams?.[1])] ?? '-'}}</div>
              </div>
              @if (isTournamentCreatedByCurrentUser() && match.status !== 'completed') {
              <button type="button" class="btn btn-sm btn-outline-light" (click)="startEdit(match)" title="Enter results">Edit</button>
              }
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
